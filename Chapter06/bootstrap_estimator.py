# ------------------------------------------------------------
# ブートストラップ法（Bootstrap Method）による平均推定のシミュレーション
# ------------------------------------------------------------
import random
import numpy as np
import matplotlib.pyplot as plt

# ------------------------------------------------------------
# 1. 母集団データの生成
# ------------------------------------------------------------
random.seed(7)  # 再現性を確保するための乱数シード
PopData = [50 * random.random() for _ in range(1000)]  # 一様分布[0, 50)の母集団

# ------------------------------------------------------------
# 2. 母集団からの単純無作為抽出
# ------------------------------------------------------------
PopSample = random.choices(PopData, k=100)  # 標本サイズ100

# ------------------------------------------------------------
# 3. ブートストラップ標本の生成と平均の推定
# ------------------------------------------------------------
PopSampleMean = []
for i in range(10000):  # 1万回の再標本化
    SampleI = random.choices(PopData, k=100)
    PopSampleMean.append(np.mean(SampleI))

# ------------------------------------------------------------
# 4. ブートストラップ推定値の分布を可視化
# ------------------------------------------------------------
plt.figure(figsize=(7, 4))
plt.hist(PopSampleMean, bins=30, color="lightgreen", edgecolor="black")
plt.title("Bootstrap Sampling Distribution of the Mean")
plt.xlabel("Sample Mean")
plt.ylabel("Frequency")
plt.grid(True)
plt.show()

# ------------------------------------------------------------
# 5. 各平均値の比較
# ------------------------------------------------------------
MeanPopSampleMean = np.mean(PopSampleMean)
MeanPopData = np.mean(PopData)
MeanPopSample = np.mean(PopSample)

print(f"ブートストラップ推定値の平均 = {MeanPopSampleMean:.3f}")
print(f"母集団の平均値 = {MeanPopData:.3f}")
print(f"単純標本の平均値 = {MeanPopSample:.3f}")

# ------------------------------------------------------------
# 6. 理論的背景
# ------------------------------------------------------------
# ブートストラップ法とは：
# ・母集団分布が未知のとき、観測データから繰り返し標本を生成して
#   統計量（平均・分散・信頼区間など）の分布を近似する再標本化手法。
#
# 手順：
#   1. 母集団データ（または標本）からサイズnのデータを復元抽出で再サンプリング
#   2. 各サンプルで統計量（ここでは平均）を計算
#   3. これを多数回繰り返して統計量の分布を推定
#
# ブートストラップ分布の平均 ≒ 母集団の平均 に近づき、
# 標準偏差（標準誤差）は推定の不確実性を評価する指標となる。
